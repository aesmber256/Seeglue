/// <reference path="seeglue.d.ts" />
/// <reference path="deno.d.ts" />
export default { build: build, clean: clean } satisfies Seeglue.BuildScript

async function build(b: Seeglue.BuildEnv) {
    b.compiler = "gcc";
    b.standard = "c11";
    b.output = "bin/out.exe";
    b.outputKind = "app";

    const unit: Seeglue.CompileUnit = {
        input: new Set()
    };

    for await (const file of b.fs.globFiles("src/**/*.c")) {
        unit.input.add(file);
    }

    b.compile.units.add(unit);
}

async function clean(b: Seeglue.BuildEnv) {
    if (b.isDryRun)
        return;

    await b.fs.rm("bin");
}